#!/bin/sh /etc/rc.common

START=99

start() {

logger -t tweak-cpu "Starting Tweak Cpu Core"

IFACE=$(ls /sys/class/net)
	
for i in ${IFACE}; do
	ethtool -K $i gro on 2>/dev/null
	if [[ -e /sys/class/net/$i/queues/rx-0/rps_cpus ]]; then
		if [[ $i = "wwan0" ]]; then
			echo f > /sys/class/net/$i/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/wwan0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/wwan0_1/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/br-lan/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth1/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth2/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth3/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth4/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/sit0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/soc0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/wifi0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/wifi1/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/ifb0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/ifb1/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/gretap0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/erspan0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/bond0/queues/rx-0/rps_cpus
		else
			echo f > /sys/class/net/$i/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/wwan0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/wwan0_1/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/br-lan/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth1/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth2/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth3/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth4/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/sit0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/soc0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/wifi0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/wifi1/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/ifb0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/ifb1/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/gretap0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/erspan0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/bond0/queues/rx-0/rps_cpus
		fi
	fi
done

}

stop() {

logger -t tweak cpu "Stopping Tweak Cpu Core"

IFACE=$(ls /sys/class/net)
	
for i in ${IFACE}; do
	ethtool -K $i gro on 2>/dev/null
	if [[ -e /sys/class/net/$i/queues/rx-0/rps_cpus ]]; then
		if [[ $i = "wwan0" ]]; then
			echo f > /sys/class/net/$i/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/wwan0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/wwan0_1/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/br-lan/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth1/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth2/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth3/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth4/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/sit0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/soc0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/wifi0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/wifi1/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/ifb0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/ifb1/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/gretap0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/erspan0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/bond0/queues/rx-0/rps_cpus
		else
			echo f > /sys/class/net/$i/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/wwan0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/wwan0_1/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/br-lan/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth1/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth2/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth3/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/eth4/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/sit0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/soc0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/wifi0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/wifi1/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/ifb0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/ifb1/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/gretap0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/erspan0/queues/rx-0/rps_cpus
                        echo f > /sys/class/net/bond0/queues/rx-0/rps_cpus
		fi
	fi
done

}
